---
import { type CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";

interface Props {
  durationList: CollectionEntry<"spells">["data"]["spell"][0]["duration"];
  class?: string;
}

const { class: className, durationList, ...rest } = Astro.props;

const needsConcentration = durationList.some((duration) =>
  Object.keys(duration).includes("concentration"),
);
---

<div class:list={[className, { concentration: needsConcentration }]} {...rest}>
  {
    durationList.map((duration) => {
      if (duration.type === "instant") {
        return <Icon name="lightning-bolt" />;
      } else if (duration.type === "timed") {
        return (
          <div>
            <Icon name="timelapse" />
            {duration.duration ? (
              <span>{`${duration.duration.amount} ${duration.duration.type}${duration.duration.amount > 1 ? "s" : ""}`}</span>
            ) : null}
          </div>
        );
      } else if (duration.type === "permanent") {
        return (
          <div>
            <Icon name="infinity" />
            {duration.ends.map((end) => (
              <span>{end}</span>
            ))}
          </div>
        );
      } else if (duration.type === "special") {
        return (
          <div>
            <Icon name="infinity" />
          </div>
        );
      } else {
        return <pre>{JSON.stringify(duration, undefined, 2)}</pre>;
      }
    })
  }
  {
    needsConcentration ? (
      <span class="concentration-hint">(concentration)</span>
    ) : null
  }
</div>

<style>
  div {
    display: flex;
    flex-direction: column;
    gap: var(--size-4);
    justify-content: center;
    align-items: center;
    border-radius: var(--border-radius);

    &.concentration {
      background-color: var(--teal);

      [data-icon] {
        color: var(--background-color) !important;
      }

      span {
        color: var(--background-color);
        font-weight: bold;
        padding: 0 var(--size-4) var(--size-4) var(--size-4);
      }

      .concentration-hint {
        display: none;
      }

      @media print {
        background-color: transparent;

        [data-icon] {
          color: var(--teal) !important;
        }

        span {
          color: var(--teal);
          font-weight: unset;
          padding: 0;
        }

        .concentration-hint {
          display: inline;
          font-style: italic;
        }
      }
    }
  }

  [data-icon] {
    --icon-size: var(--size-32);

    width: var(--icon-size);
    height: var(--icon-size);
  }

  span {
    font-size: var(--font-size-12);
  }
</style>
